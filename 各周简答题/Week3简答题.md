# 混合操作包含以下两要素原因？

### 1.关闭深度写入

+ 假设半透明物体A开启深度写入，在进行深度测试时，与深度缓冲中不透明物体B深度值相比，离摄像机更近，会直接把A的深度值覆盖掉B的，颜色值也会覆盖掉，B会看不到。

### 2.渲染顺序从后往前

##### （1）半透明物体A在不透明B的前面

+ **渲染顺序从前往后**

  如果先渲染A，此时深度缓冲和颜色缓冲中都没有值，A不会写入到深度缓冲中，颜色值会写入到颜色缓冲中。再渲染B，深度测试此时深度缓冲中没有值，B的深度写入到深度缓冲中，**直接覆盖掉A的颜色，导致看不到A，只能看到B。**

+ **渲染顺序从后往前**

  如果先渲染B，B的深度值、颜色值写入深度缓冲、颜色缓冲，A进行深度测试，深度值比深度缓冲里深度值    小，距离摄像机更近，**会用A的透明度跟颜色缓冲中的颜色值进行混合**。

##### （2）两个半透明物体A跟B，A在B前面

+ **渲染顺序从前往后**

  如果先渲染A，此时深度缓冲和颜色缓冲中都没有值，A不会写入到深度缓冲中，颜色值会写入到颜色缓冲中，B进行深度测试，但是此时深度缓冲中没有值，而颜色缓冲中有颜色值，**那么B就会和A进行混合，看起来B在A前面，得到错误结果。**

+ **渲染顺序从后往前**

  如果先渲染B，此时深度缓冲和颜色缓冲中都没有值，B不会写入到深度缓冲中，颜色值会写入到颜色缓冲中，A进行深度测试，但是此时深度缓冲中没有值，而颜色缓冲中有颜色值，**那么A就会和B进行混合，看起来A在B前面，结果正确。**
  

# 一般的渲染顺序是？

+ (1)**先渲染所有不透明物体**（RenderQueue<2500,Opaque队列），并开启它们的深度测试和深度写入。

  + 不同的物体首先**由摄像机的深度决定渲染顺序**，**深度值越大优先级越高**，开启深度写入后，相同位置深度靠后会被裁剪掉。
  + 同摄像机不透明物体渲染顺序**由对象上的Z值决定**。不透明物体**由近到远排序优先**。

+ (2)**再渲染所有（半）透明物体**（RenderQueue>2500,Transparent队列）并开启它们的深度测试，但关闭深度写入。

  + 同摄像机下（半）透明物体

    + **SortingLayer**
      SortingLayer是渲染对象的排序层级，在编辑面板中**越靠后的层级越高，越往后渲染。**

    + **Order In Layer**

      当两个渲染对象的SortingLayer一致的时候，比较Order In Layer的数值，**数值越大越靠后渲染，层级越高。**

    + **RenderQueue**
      当上面的条件都一致的时候，我们判断RenderQueue的值，**值越大，越靠后渲染，层级越高。**

    + **深度排序**
      （半）透明物体按它们**距离摄像机的远近进行排序**，然后按照**从后往前的顺序**渲染这些(半)透明物体

  

